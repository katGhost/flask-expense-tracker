{% extends "layout.html" %}

{% block title %}Reports{% endblock %}

{% block main %}
  <div class="w-full max-w-7xl mx-auto px-4 py-6">

    <!-- Header & Description -->
    <div class="mb-6">
      <h3 class="text-2xl font-semibold text-gray-900 dark:text-gray-100">
        View Reports
      </h3>
      <p class="mt-2 text-gray-700 dark:text-gray-300">
        Your reports are here, organized in two charts â€” a Pie Chart on the left and a Bar Chart on the right. View metrics on your spending and budgeting by category.
      </p>
    </div>

    <!-- Charts -->
    <div class="flex flex-col lg:flex-row gap-6">
      <!-- Pie Chart -->
      <div class="flex-1 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md">
        <canvas id="pie-chart" class="w-full h-64"></canvas>
      </div>

      <!-- Bar Chart -->
      <div class="flex-1 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md">
        <canvas id="bar-chart" class="w-full h-64"></canvas>
      </div>
    </div>

  </div>

  <!-- Scripts -->
  <script>
    $(document).ready(function() {
      $.ajax({
        url: "/api/reports-data",
        type: "GET",
        dataType: "json",
        success: function(data) {

          // Pie / Doughnut Chart
          const pieCtx = document.getElementById("pie-chart").getContext("2d");
          new Chart(pieCtx, {
            type: 'doughnut',
            data: {
              labels: data.pie.labels || [],
              datasets: [{
                label: data.pie.title || '',
                data: data.pie.values || []
              }]
            },
            options: {
              plugins: {
                legend: { display: true },
                tooltip: { enabled: true }
              }
            }
          });

          // Bar Chart
          const barCtx = document.getElementById("bar-chart").getContext("2d");
          new Chart(barCtx, {
            type: 'bar',
            data: {
              labels: data.bar.labels || [],
              datasets: [{
                label: data.bar.title || '',
                data: data.bar.values || []
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { display: true },
                tooltip: { enabled: true }
              },
              scales: {
                x: { beginAtZero: true },
                y: { beginAtZero: true }
              }
            }
          });

        },
        error: function(error) {
          console.error("Error fetching report data:", error);
        }
      });
    });
  </script>
{% endblock %}
