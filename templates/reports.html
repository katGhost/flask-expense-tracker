{% extends "layout.html" %}

{% block title %} Reports {% endblock %}

{% block main %}
  <div class="main-container">
    <div class="mb-3 reports-header">
      <h3>View Reports</h3>
      <div class="reports-summary">
        <p>Your reports are here, organized in two charts, Pie Chart on the left and Bar Chart on the right.
          Here you can view the metrics of your spending on Expenses and your Budget allocation per Category
          and get a simple overview on how you spend your money and on what.
        </p>
      </div>
    </div>

    <div class="reports">
      <h4 class="mb-3">Monthly Reports</h4>
      <div class="reports-container">
        <div class="chart-left">
          <canvas id="pie-chart"></canvas>
        </div>
        <div class="chart-right">
          <canvas id="bar-chart"></canvas>
        </div>
      </div>
    </div>
    
  </div>

  

  <script>
    $(document).ready(function() {

        // first chart - pie or doughnut
        $.ajax({
          url:"/api/reports-data",
          type: "GET",
          dataType: "json",
          success: function(data){
            // PIE CHART RENDERING
            const pieChart = document.getElementById("pie-chart").getContext("2d");
    
            new Chart(pieChart, {
              type: 'doughnut',
              data: {
                labels: data.pie.labels || [],
                datasets: [{
                  label: data.pie.title || '',
                  data: data.pie.values || [],
                }]
              },
              options: {
                plugins: {
                  legend: { display: true },
                  tooltip: { enabled: true },
                },
                elements: {
                  arc: {
                    backgroundColor: [
                      'rgba(155, 191, 224, 0.8)',
                      'rgba(232, 160, 154, 0.8)',
                      'rgba(251, 226, 159, 0.8)',
                      'rgba(198, 214, 143, 0.8)',
                      'rgba(214, 201, 189, 0.8)'
                    ],
                    hoverOffset: 4,
                  }
                }
              }
            });
    
            // BAR CHART RENDERING
            const barChart = document.getElementById("bar-chart").getContext("2d");
    
            new Chart(barChart, {
              type: 'bar',
              data: {
                labels: data.bar.labels || [],
                datasets: [{
                  label: data.bar.title || '',
                  data: data.bar.values || []
                }]
              },
              options: {
                responsive: true,
                plugins: {
                  legend: { display: true },
                  tooltip: { enabled: true },
                },
                scales: {
                  x: { 
                    beginAtZero: true 
                  },
                  y: {
                    beginAtZero: true
                  }
                }
              },
            });
          },
          error: function(error) {
            console.error("Error fetching pie chart data:", error);
          }
        });
      });
  </script>
{% endblock %}
