{% extends "layout.html" %}

{% block title %} Home {% endblock %}

{% block main %}
<div class="w-full max-w-7xl mx-auto px-4 py-6">

  <h3 class="mb-6 text-2xl font-semibold text-gray-900 dark:text-gray-100">Overview</h3>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

    <!-- Recent Expense -->
    <div class="rounded-lg bg-gradient-to-br from-green-400 to-emerald-600 p-6 shadow-md text-gray-900 dark:text-gray-100">
      <h5 class="text-lg font-semibold mb-1">Recent Expense</h5>
      <p class="text-sm mb-2">Recently created for the current month.</p>
      <span class="font-bold">{{ expense.amount }}</span> | 
      <span>{{ expense.created_at }}</span>
    </div>

    <!-- Recent Budget Entry -->
    <div class="rounded-lg bg-gradient-to-br from-green-400 to-emerald-600 p-6 shadow-md text-gray-900 dark:text-gray-100">
      <h5 class="text-lg font-semibold mb-1">Recent Budget Entry</h5>
      <p class="text-sm mb-2">Recently entered Budget for the current month.</p>
      <span class="font-bold">{{ budget.budget_limit }}</span> | 
      <span>{{ budget.month }}/{{ budget.year }}</span>
    </div>

    <!-- Top Expense -->
    <div class="rounded-lg bg-gradient-to-br from-green-400 to-emerald-600 p-6 shadow-md text-gray-900 dark:text-gray-100">
      <h5 class="text-lg font-semibold mb-1">Top Expense</h5>
      <p class="text-sm mb-2">Top Expense by category, most spent on.</p>
      <span class="font-bold">{{ top_category.total_spent }}</span> | 
      <span>{{ top_category.name }}</span>
    </div>

  </div>

  <!-- Bar Chart -->
  <div class="mt-8 bg-white dark:bg-gray-800 p-4 shadow-md rounded-lg">
    <canvas id="line-chart" class="w-full h-80"></canvas>
  </div>

</div>

<script>
  $(document).ready(function() {
    $.ajax({
      url: "/api/chart-data",
      type: "GET",
      dataType: "json",
      success: function(data){
        const ctx = document.getElementById("line-chart").getContext("2d");
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: data.keys || [],
            datasets: [{
              label: data.label || '',
              data: data.values || [],
              backgroundColor: data.colors || '#00ACC1',
              borderColor: data.borderColors || '#00ACC1',
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: true },
              title: { display: true, text: data.title || '' }
            },
            scales: { y: { beginAtZero: true } }
          }
        });
      },
      error: function(error) {
        console.error("Error fetching chart data:", error);
      }
    });
  });
</script>
{% endblock %}
