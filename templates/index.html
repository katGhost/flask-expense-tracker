{% extends "layout.html" %}

{% block title %} Home {% endblock %}

{% block main %}
<div class="main-container">
  <h3 class="mb-3 text-fg-brand">Overview</h3>
  <div class="mb-3 top">
    <!-- latest budget entered and some details about it -->
    <div class="summary">
      <h5 class="summary-title">Recent Expense</h5>
      <p class="summary-desc">
        Recently created for the current month.
      </p>
      <span class="fw-bold amount-summary">{{expense.amount}}</span> | <span class="date_summary">{{expense.created_at}}</span>
    </div>
    <!-- Expenses summary (perhaps the sum(total) amount of all expenses) -->
    <div class="summary">
      <h5 class="summary-title">Recent Budget Entry</h5>
      <p class="summary-desc">
        Recently entered Budget for the current month.
      </p>
      <span class="fw-bold amount-summary">{{budget.budget_limit}}</span> | <span class="date_summary">{{budget.month}}/{{budget.year}}</span>
    </div>
    <!-- Sum of amount spent on spendings (Expenses maybe) -->
     <!-- OR Remaining amount -->
    <div class="summary">
      <h5 class="summary-title">Top Expense</h5>
      <p class="summary-desc">
        Top Expense by category, most spent on.
      </p>
      <span class="fw-bold amount-summary">{{top_category.total_spent}}</span> | <span class="date_summary">{{top_category.name}}</span>
    </div>
  </div>

  <!-- Bar Chart -->
  <div class="mt-5 bar-chart-wrapper">
    <canvas id="line-chart" width="800" height="350"></canvas>
  </div>
</div>
  

  <!-- SCRIPT -->

  <script>
    $(document).ready(function() {
      $.ajax({
        url: "/api/chart-data",
        type: "GET",
        dataType: "json",
        success: function(data){
          var lineChart = document.getElementById("line-chart").getContext("2d");
          // render the bar chart
          new Chart(lineChart, {
            type: 'line',
            data: {
              labels: data.keys || [],
              datasets: [{
                label: data.label || '',
                data: data.values || [],
                backgroundColor: data.colors || '#00ACC1',
                borderColor: data.borderColors || '#00ACC1',
                borderWidth: 1
              }]
            },
            // Chart.js options: configure responsiveness, plugins (legend and title), and y-axis scale
            options: {
              responsive: true,
              plugins: {
                legend: { display: true },
                title: { display: true, text: data.title || '' }
              },
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
        },
        error: function(error) {
          console.error("Error fetching chart data:", error);
        }
      });
    });
  </script>



{% endblock %}